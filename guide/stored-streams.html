
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />

<title>Stored Streams - Scanner</title>


    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performance Profiling" href="profiling.html" />
    <link rel="prev" title="Operations" href="ops.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133298183-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-133298183-1');
</script>


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="profiling.html" title="Performance Profiling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ops.html" title="Operations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Scanner 0.2.22 documentation</a> &#187;</li> 
      </ul>
    </div>
<div class="container">
  <div id="navbar" class="navbar-default">
    <div class="row">
      <div class="col-md-4 col-sm-12">
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/scanner_logo.png"></span>
        </a>
      </div>
      <div class="col-md-4 offset-md-4 col-sm-12">
        <div class="btn-group">
          <a href="../guide.html"><button type="button" class="btn btn-light">Guide</button></a>
          <a href="../api.html"><button type="button" class="btn btn-light">API</button></a>
          <a href="https://github.com/scanner-research/scanner"><button type="button" class="btn btn-light">Github</button></a>
          <a href="../publications.html"><button type="button" class="btn btn-light">Publications</button></a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="bs-sidenav">
        <div class="bs-sidenav-inner"><div class="guidetoc-container">
  <div class="guidetoc"
       role="navigation">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#homebrew">Homebrew</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#from-source">From Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Walkthroughs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="walkthrough.html#converting-a-video-to-grayscale">Converting a video to grayscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough.html#walking-through-a-more-advanced-jupyter-based-app">Walking through a more advanced Jupyter-based app</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">Computation Graphs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#multiple-inputs-and-outputs">Multiple inputs and outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#batch-processing-of-stored-streams">Batch processing of stored streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#stream-operations">Stream Operations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ops.html">Operations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ops.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops.html#defining-an-operation-in-python">Defining an Operation in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops.html#declaring-parameters">Declaring Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops.html#fetching-resources">Fetching Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops.html#operation-properties">Operation Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops.html#defining-an-operation-in-c">Defining an Operation in C++</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stored Streams</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storage-backends">Storage Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-o-operations">I/O Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading-data-locally">Reading Data Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deleting-stored-streams">Deleting Stored Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inplace-video-indexing">Inplace video indexing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Performance Profiling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#trace-visualization">Trace Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#scanner-s-execution-model">Scanner’s Execution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#tunable-parameters">Tunable Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes Integration</a></li>
</ul>

  </div>
</div>
        </div>
      </div>
    </div>
    <div class="col-md-9">
      <div class="content">
        
  <div class="section" id="stored-streams">
<span id="id1"></span><h1>Stored Streams<a class="headerlink" href="#stored-streams" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Scanner represents input and output data as sequences of data items called <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StoredStream" title="scannerpy.storage.StoredStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">StoredStream</span></code></a>. Stored streams are Python objects that describe to Scanner how to read data to be processed and how to write data after it has been processed by a Scanner application. Stored streams can represent data stored in a variety of locations or formats:</p>
<ul class="simple">
<li><p>Video files (mp4, mkv, etc).</p></li>
<li><p>Collections of files (images, text, etc)</p></li>
<li><p>Packed binary files (custom RAW formats).</p></li>
<li><p>SQL tables (image metadata)</p></li>
</ul>
<p>For example, the following code creates a stored stream for a video file named <code class="code docutils literal notranslate"><span class="pre">example.mp4</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scannerpy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">video_stream</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">NamedVideoStream</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;example.mp4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.NamedVideoStream" title="scannerpy.storage.NamedVideoStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedVideoStream</span></code></a> is a special type of stored stream which represents data stored inside Scanner’s internal datastore. Since Scanner was built specifically for processing video, it has specialized support for fast access to frames in videos, even under random access patterns. In order to efficiently read frames from a video, Scanner needs to build an index over the compressed video. By specifying <code class="code docutils literal notranslate"><span class="pre">path</span> <span class="pre">=</span> <span class="pre">'example.mp4</span></code>, we’ve told Scanner to initialize a stream named <code class="code docutils literal notranslate"><span class="pre">example</span></code> from the <code class="code docutils literal notranslate"><span class="pre">example.mp4</span></code> video.</p>
<p>Another example of a stored stream is the <code class="xref py py-class docutils literal notranslate"><span class="pre">FilesStream</span></code>, which represents a stream of individual files stored on a filesystem or cloud blob storage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scannertools.storage.files</span> <span class="kn">import</span> <span class="n">FilesStream</span>
<span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image2.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image3.jpg&#39;</span><span class="p">]</span>
<span class="n">file_stream</span> <span class="o">=</span> <span class="n">FilesStream</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">image_paths</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <code class="xref py py-class docutils literal notranslate"><span class="pre">FilesStream</span></code> reads from the local filesystem. However, like all stored streams, the storage location and configuration options can be specified with a <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StorageBackend" title="scannerpy.storage.StorageBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">StorageBackend</span></code></a>.</p>
<p>Te rest of this guide explains the additional features of stored streams.</p>
</div>
<div class="section" id="storage-backends">
<h2>Storage Backends<a class="headerlink" href="#storage-backends" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StorageBackend" title="scannerpy.storage.StorageBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">StorageBackend</span></code></a> s represent the specific storage location or format for stored streams. For example, <code class="xref py py-class docutils literal notranslate"><span class="pre">FilesStream</span></code> can be configured to read files from Amazon’s S3 storage service instead of the default local file system by creating the appropriate storage backend:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scannertools.storage.files</span> <span class="kn">import</span> <span class="n">FileStorage</span><span class="p">,</span> <span class="n">FilesStream</span>
<span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image2.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image3.jpg&#39;</span><span class="p">]</span>
<span class="n">file_storage</span> <span class="o">=</span> <span class="n">FileStorage</span><span class="p">(</span><span class="n">storage_type</span><span class="o">=</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span>
                           <span class="n">bucket</span><span class="o">=</span><span class="s1">&#39;example-bucket&#39;</span><span class="p">,</span>
                           <span class="n">region</span><span class="o">=</span><span class="s1">&#39;us-west-1&#39;</span><span class="p">)</span>
<span class="n">file_stream</span> <span class="o">=</span> <span class="n">FilesStream</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">image_paths</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="n">file_storage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="i-o-operations">
<h2>I/O Operations<a class="headerlink" href="#i-o-operations" title="Permalink to this headline">¶</a></h2>
<p>I/O operations allow Scanner applications to read and write to stored streams. To read from a stored stream, Scanner applications construct <a class="reference internal" href="../api/scannerpy.html#scannerpy.io.IOGenerator.Input" title="scannerpy.io.IOGenerator.Input"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Input()</span></code></a> operations, specifying a list of stored streams:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Input</span><span class="p">([</span><span class="n">video_stream</span><span class="p">])</span>
</pre></div>
</div>
<p>This code creates a sequence of video frames, <code class="code docutils literal notranslate"><span class="pre">frame</span></code>, that can be used in the context of a Scanner computation graph to read the video specified by <code class="code docutils literal notranslate"><span class="pre">video_stream</span></code> (to learn more about computation graphs, check out the <a class="reference internal" href="graphs.html#graphs"><span class="std std-ref">Computation Graphs</span></a>. guide). Stored streams are also used to specify where to write data to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_video_stream</span> <span class="o">=</span> <span class="n">NamedVideoStream</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s1">&#39;example-output&#39;</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">[</span><span class="n">output_video_stream</span><span class="p">])</span>
</pre></div>
</div>
<p>Here, the frames we read in from before will be written back out to a <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.NamedVideoStream" title="scannerpy.storage.NamedVideoStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedVideoStream</span></code></a> called <code class="code docutils literal notranslate"><span class="pre">example-output</span></code>.</p>
</div>
<div class="section" id="reading-data-locally">
<h2>Reading Data Locally<a class="headerlink" href="#reading-data-locally" title="Permalink to this headline">¶</a></h2>
<p>Stored streams can be read directly in Python by calling the <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StoredStream.load" title="scannerpy.storage.StoredStream.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">video_stream</span><span class="o">.</span><span class="n">load</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>Reading from this stream lazily loads video frames from <code class="code docutils literal notranslate"><span class="pre">video_stream</span></code> as numpy arrays. If we were reading bounding boxes or some other data format, the <code class="code docutils literal notranslate"><span class="pre">load</span></code> method would return data elements formatted according to the data type of the stream.</p>
</div>
<div class="section" id="deleting-stored-streams">
<h2>Deleting Stored Streams<a class="headerlink" href="#deleting-stored-streams" title="Permalink to this headline">¶</a></h2>
<p>Stored stream data is persistent: unless a stored stream is explicitly deleted, the data will stay around and can be used in future Scanner applications. A stored stream can be deleted by invoking the <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StoredStream.delete" title="scannerpy.storage.StoredStream.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">video_stream</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
<p>If there are multiple streams to delete, it can be more efficient to invoke a bulk delete operation by calling <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.StorageBackend.delete" title="scannerpy.storage.StorageBackend.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a> on the storage backend itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">video_stream</span><span class="o">.</span><span class="n">storage</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="p">[</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="inplace-video-indexing">
<h2>Inplace video indexing<a class="headerlink" href="#inplace-video-indexing" title="Permalink to this headline">¶</a></h2>
<p>By default, Scanner copies the video data for a <a class="reference internal" href="../api/scannerpy.html#scannerpy.storage.NamedVideoStream" title="scannerpy.storage.NamedVideoStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedVideoStream</span></code></a> to Scanner’s internal database (located at <code class="code docutils literal notranslate"><span class="pre">~/.scanner/db</span></code> by default) when it builds the index over the video for fast frame access. For a limited set of video container formats (currently only MP4), Scanner also supports accessing videos without copying them using the <code class="code docutils literal notranslate"><span class="pre">inplace=True</span></code> flag:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_stream</span> <span class="o">=</span> <span class="n">NamedVideoStream</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s1">&#39;sample-clip&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;sample-clip.mp4&#39;</span><span class="p">,</span>
                                <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This still builds the index for accessing the video but avoids copying the files. When Scanner accesses the video data, it will read it directly from the path provided to the named video stream.</p>
</div>
</div>


      </div>
    </div>
  </div>
</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="profiling.html" title="Performance Profiling"
             >next</a> |</li>
        <li class="right" >
          <a href="ops.html" title="Operations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Scanner 0.2.22 documentation</a> &#187;</li> 
      </ul>
    </div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>